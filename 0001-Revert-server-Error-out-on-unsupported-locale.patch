From 36d34a416a9d7aeff723acfc784b09d37bd9bcc8 Mon Sep 17 00:00:00 2001
From: Ray Strode <rstrode@redhat.com>
Date: Mon, 4 Apr 2016 12:12:49 -0400
Subject: [PATCH] Revert "server: Error out on unsupported locale"

This reverts commit 27051edaea86908d8852e7bc66d88215b51fc179.
---
 src/server.c | 7 +------
 1 file changed, 1 insertion(+), 6 deletions(-)

diff --git a/src/server.c b/src/server.c
index ee21633..ecbed3f 100644
--- a/src/server.c
+++ b/src/server.c
@@ -80,80 +80,75 @@ atfork_child_restore_rlimit_nofile (void)
 }
 
 static gboolean
 increase_rlimit_nofile (void)
 {
   struct rlimit l;
 
   if (getrlimit (RLIMIT_NOFILE, &sv_rlimit_nofile) < 0)
     return FALSE;
 
   if (pthread_atfork (NULL, NULL, atfork_child_restore_rlimit_nofile) != 0)
     return FALSE;
 
   l.rlim_cur = l.rlim_max = sv_rlimit_nofile.rlim_max;
   if (setrlimit (RLIMIT_NOFILE, &l) < 0)
     return FALSE;
 
   return TRUE;
 }
 
 enum {
   _EXIT_FAILURE_WRONG_ID = 7,
   _EXIT_FAILURE_NO_UTF8 = 8,
 };
 
 int
 main (int argc, char **argv)
 {
   GApplication *app;
   int exit_code = EXIT_FAILURE;
-  const char *home_dir, *charset;
+  const char *home_dir;
   GError *error = NULL;
 
   if (G_UNLIKELY ((getuid () != geteuid () ||
                   getgid () != getegid ()) &&
                   geteuid () == 0 &&
                   getegid () == 0)) {
     g_printerr ("Wrong euid/egid, exiting.\n");
     return _EXIT_FAILURE_WRONG_ID;
   }
 
   setlocale (LC_ALL, "");
 
   terminal_i18n_init (TRUE);
 
-  if (!g_get_charset (&charset)) {
-    g_printerr ("Non UTF-8 locale (%s) is not supported!\n", charset);
-    return _EXIT_FAILURE_NO_UTF8;
-  }
-
   /* Sanitise environment */
   g_unsetenv ("DBUS_STARTER_BUS_TYPE");
 
 #ifndef ENABLE_DISTRO_PACKAGING
 #ifdef HAVE_UBUNTU
   /* Set some env vars to disable the ubuntu modules. Their package will be 
    * built using --enable-distro-packaging, but anyone running from git will
    * get the right behaviour.
    */
   g_setenv ("LIBOVERLAY_SCROLLBAR", "0", TRUE);
   g_setenv ("UBUNTU_MENUPROXY", "0", TRUE);
   g_setenv ("NO_UNITY_GTK_MODULE", "1", TRUE);
 #endif
 #endif
 
   _terminal_debug_init ();
 
   // FIXMEchpe: just use / here but make sure #565328 doesn't regress
   /* Change directory to $HOME so we don't prevent unmounting, e.g. if the
    * factory is started by nautilus-open-terminal. See bug #565328.
    * On failure back to /.
    */
   home_dir = g_get_home_dir ();
   if (home_dir == NULL || chdir (home_dir) < 0)
     (void) chdir ("/");
 
   g_set_prgname ("gnome-terminal-server");
   g_set_application_name (_("Terminal"));
 
   if (!gtk_init_with_args (&argc, &argv, NULL, options, NULL, &error)) {
-- 
2.8.0

